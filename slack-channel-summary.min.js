!function(){"use strict";const e={log:function(e){console.log(`üîß SLACKPOLISH: ${e}`)},debug:function(e,t=null){try{n.loadSettings().debugMode&&window.SlackPolishDebug&&(console.log(`üêõ SLACKPOLISH DEBUG: ${e}`,t||""),window.SlackPolishDebug.addLog("channel-summary",e,t))}catch(n){console.log(`üêõ SLACKPOLISH DEBUG: ${e}`,t||"")}}},n={defaultSettings:{debugMode:!1,apiKey:""},loadSettings:function(){try{const e=localStorage.getItem("slackpolish_settings"),n=localStorage.getItem("slackpolish_openai_api_key");let t={...this.defaultSettings};if(e){const n=JSON.parse(e);void 0!==n.debugMode&&(t.debugMode=n.debugMode)}return n&&(t.apiKey=n),t}catch(n){return e.log("Error loading settings: "+n.message),e.debug("Settings loading error",{error:n.message,stack:n.stack}),{...this.defaultSettings}}},createLogo:function(e=24){const n=document.createElement("img");return n.title="SlackPolish",n.alt="SlackPolish Logo",n.width=e,n.height=e,n.style.cssText=`display: block; border: none; width: ${e}px !important; height: ${e}px !important; max-width: ${e}px; max-height: ${e}px;`,n.src=window.SLACKPOLISH_LOGO_BASE64||"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1MTIiIGhlaWdodD0iNTEyIj48Y2lyY2xlIGN4PSIyNTYiIGN5PSIyNTYiIHI9IjIwMCIgZmlsbD0iIzEyNjRhMyIvPjx0ZXh0IHg9IjI1NiIgeT0iMjgwIiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iMTIwIiBmaWxsPSJ3aGl0ZSIgdGV4dC1hbmNob3I9Im1pZGRsZSI+U1A8L3RleHQ+PC9zdmc+",n.onerror=function(){const n=document.createElement("span");n.textContent="SP",n.title="SlackPolish",n.style.cssText=`\n                    font-size: ${e}px;\n                    font-weight: bold;\n                    color: #1264a3;\n                    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n                `,this.parentNode.replaceChild(n,this)},n},showChannelSummary:function(){const n=document.getElementById("slackpolish-channel-summary-window");if(n)return void n.remove();const t=this.detectThreadContext();e.debug("üîç EARLY THREAD DETECTION FOR GUI",t);const a=document.createElement("div");a.id="slackpolish-channel-summary-window",a.innerHTML=this.createChannelSummaryHTML(t),document.body.appendChild(a),a._threadContext=t;const s=a.querySelector("#channel-summary-logo");s&&s.appendChild(this.createLogo(48)),this.setupSummaryEventListeners(a)},detectThreadContext:function(){const e=window.location.href,n=e.includes("/thread/"),t=document.activeElement,a=t&&(t.closest('[data-qa*="thread"]')||t.closest(".p-thread")||t.closest(".c-thread")),s=document.querySelector('[data-qa="threads_view"]:not([style*="display: none"])')||document.querySelector('.p-threads_view:not([style*="display: none"])')||document.querySelector('[data-qa="thread_view"]:not([style*="display: none"])'),r=document.querySelector('[data-qa="thread_message_input"]:not([style*="display: none"])')||document.querySelector('.p-thread_input:not([style*="display: none"])');return{isInThread:n||a||!!s&&!!r,url:e,urlHasThread:n,hasVisibleThreadContainer:!!s,hasThreadInput:!!r,isInThreadInput:a,activeElementInfo:t?{tagName:t.tagName,className:t.className,dataQa:t.getAttribute("data-qa")}:null}},createChannelSummaryHTML:function(e=null){const n=e&&e.isInThread;return`\n                <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 10001; display: flex; align-items: center; justify-content: center;">\n                    <div style="background: white; border: 1px solid #ddd; border-radius: 8px; padding: 20px; box-shadow: 0 4px 20px rgba(0,0,0,0.3); font-family: Arial, sans-serif; width: 700px; max-height: 90vh; overflow-y: auto;">\n\n                        \x3c!-- Header --\x3e\n                        <div style="display: flex; align-items: center; margin-bottom: 20px; padding: 12px; background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); border-radius: 8px; border: 1px solid #dee2e6;">\n                            <div style="background: white; border-radius: 8px; padding: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-right: 16px; display: flex; align-items: center; justify-content: center;" id="channel-summary-logo">\n                            </div>\n                            <div style="flex: 1;">\n                                <div style="font-weight: bold; font-size: 18px; color: #2c3e50; margin-bottom: 4px;">${n?"SlackPolish Thread Summary":"SlackPolish Channel Summary"}</div>\n                                <div style="font-size: 13px; color: #6c757d;">${n?"AI-powered thread summarization":"AI-powered channel summarization"}</div>\n                            </div>\n                        </div>\n\n                        \x3c!-- Time Range and Summary Level Selection (Side by Side) --\x3e\n                        <div style="display: flex; gap: 12px; margin-bottom: 12px;">\n                            <div style="flex: 1;">\n                                <label style="display: block; margin-bottom: 4px; font-weight: bold; font-size: 13px;">üìÖ Time Range:</label>\n                                <select id="time-range-select" style="width: 100%; padding: 6px; border: 1px solid #ddd; border-radius: 4px; font-size: 13px; box-sizing: border-box; background: white;">\n                                    ${n?'<option value="thread" selected>Full thread</option>':'<option value="1">24 hours</option>\n                                         <option value="7" selected>7 days</option>\n                                         <option value="30">30 days</option>\n                                         <option value="all">Entire channel</option>'}\n                                </select>\n                            </div>\n                            <div style="flex: 1;">\n                                <label style="display: block; margin-bottom: 4px; font-weight: bold; font-size: 13px;">üìä Summary Level:</label>\n                                <select id="summary-level-select" style="width: 100%; padding: 6px; border: 1px solid #ddd; border-radius: 4px; font-size: 13px; box-sizing: border-box; background: white;">\n                                    <option value="executive" selected>üìã Executive Summary</option>\n                                    <option value="comprehensive">üìö Comprehensive</option>\n                                </select>\n                            </div>\n                        </div>\n\n                        \x3c!-- Summary Text Area --\x3e\n                        <div style="margin-bottom: 12px;">\n                            <label style="display: block; margin-bottom: 4px; font-weight: bold; font-size: 13px;">üìù Channel Summary:</label>\n                            <textarea id="summary-textbox" placeholder="Channel summary will appear here..." style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 4px; font-size: 13px; box-sizing: border-box; height: 250px; resize: vertical; font-family: inherit;"></textarea>\n                        </div>\n\n                        \x3c!-- Action Buttons --\x3e\n                        <div style="text-align: right; margin-top: 15px;">\n                            <button id="generate-summary-btn" style="padding: 8px 16px; border-radius: 4px; cursor: pointer; font-size: 13px; margin-left: 8px; border: none; background: #007a5a; color: white;">üîç Generate Summary</button>\n                            <button id="copy-summary-btn" style="padding: 8px 16px; border-radius: 4px; cursor: pointer; font-size: 13px; margin-left: 8px; border: 1px solid #ddd; background: #f8f8f8; color: #333;">üìã Copy</button>\n                            <button id="close-summary-btn" style="padding: 8px 16px; border-radius: 4px; cursor: pointer; font-size: 13px; margin-left: 8px; border: 1px solid #ddd; background: #f8f8f8; color: #333;">‚úï Close</button>\n                        </div>\n                    </div>\n                </div>\n            `},setupSummaryEventListeners:function(n){const t=n.querySelector("#generate-summary-btn"),a=n.querySelector("#copy-summary-btn"),s=n.querySelector("#close-summary-btn"),r=n.querySelector("#time-range-select"),o=n.querySelector("#summary-level-select");this.loadSavedSettings(r,o),r.addEventListener("change",(()=>{this.saveSetting("slackpolish_channel_summary_time_range",r.value),e.log(`Time range changed to: ${r.value}`)})),o.addEventListener("change",(()=>{this.saveSetting("slackpolish_channel_summary_level",o.value),e.log(`Summary level changed to: ${o.value}`)})),t.addEventListener("click",(()=>{this.showConfirmationPopup(n)})),a.addEventListener("click",(()=>{const e=n.querySelector("#summary-textbox");navigator.clipboard.writeText(e.value).then((()=>{this.showNotification("Summary copied to clipboard!","success")}))})),s.addEventListener("click",(()=>{n.remove()}));const i=e=>{"Escape"===e.key&&(n.remove(),document.removeEventListener("keydown",i))};document.addEventListener("keydown",i),n.addEventListener("click",(e=>{e.target===n&&n.remove()}))},loadSavedSettings:function(n,t){try{if(n&&1===n.options.length&&"thread"===n.options[0].value)e.log('Thread summary detected - keeping "Full thread" selected');else{const t=localStorage.getItem("slackpolish_channel_summary_time_range")||"7";n&&(n.value=t,e.log(`Loaded saved time range: ${t}`))}const a=localStorage.getItem("slackpolish_channel_summary_level")||"executive";t&&(t.value=a,e.log(`Loaded saved summary level: ${a}`)),e.debug("Channel summary settings loaded",{timeRange:savedTimeRange,summaryLevel:a})}catch(n){e.debug("Error loading saved settings",{error:n.message})}},saveSetting:function(n,t){try{localStorage.setItem(n,t),e.debug(`Setting saved: ${n} = ${t}`)}catch(a){e.debug("Error saving setting",{key:n,value:t,error:a.message})}},showConfirmationPopup:function(n){if("true"===localStorage.getItem("slackpolish_hide_summary_confirmation"))return e.debug("Confirmation popup disabled, proceeding directly to summary generation"),void this.generateChannelSummary(n);const t=document.createElement("div");t.style.cssText="\n                position: fixed;\n                top: 0;\n                left: 0;\n                width: 100%;\n                height: 100%;\n                background: rgba(0, 0, 0, 0.5);\n                z-index: 10001;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n            ";const a=document.createElement("div");a.style.cssText="\n                background: white;\n                border-radius: 8px;\n                padding: 24px;\n                max-width: 400px;\n                width: 90%;\n                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);\n                text-align: center;\n                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n            ",a.innerHTML='\n                <h3 style="margin: 0 0 16px 0; color: #333; font-size: 18px;">\n                    üìä Generate Channel Summary\n                </h3>\n                <p style="margin: 0 0 20px 0; color: #666; line-height: 1.4;">\n                    SlackPolish will analyze the messages in this channel and generate an AI-powered summary based on your selected time range and summary level.\n                </p>\n                <div style="margin: 0 0 20px 0; text-align: left;">\n                    <label style="display: flex; align-items: center; gap: 8px; font-size: 13px; color: #666; cursor: pointer;">\n                        <input type="checkbox" id="dont-show-again-checkbox" style="margin: 0;">\n                        <span>Don\'t show this message again</span>\n                    </label>\n                </div>\n                <div style="display: flex; gap: 12px; justify-content: center;">\n                    <button id="cancel-generate-btn" style="\n                        background: #f8f8f8;\n                        color: #333;\n                        border: 1px solid #ddd;\n                        padding: 10px 20px;\n                        border-radius: 4px;\n                        font-size: 14px;\n                        cursor: pointer;\n                        font-weight: bold;\n                    ">\n                        Let me scroll\n                    </button>\n                    <button id="confirm-generate-btn" style="\n                        background: #007a5a;\n                        color: white;\n                        border: none;\n                        padding: 10px 20px;\n                        border-radius: 4px;\n                        font-size: 14px;\n                        cursor: pointer;\n                        font-weight: bold;\n                    ">\n                        OK, Generate Summary\n                    </button>\n                </div>\n            ',t.appendChild(a),document.body.appendChild(t);const s=a.querySelector("#dont-show-again-checkbox");"true"===localStorage.getItem("slackpolish_hide_summary_confirmation")&&(s.checked=!0);a.querySelector("#confirm-generate-btn").addEventListener("click",(()=>{s.checked?(localStorage.setItem("slackpolish_hide_summary_confirmation","true"),e.debug("User opted to hide summary confirmation popup")):(localStorage.removeItem("slackpolish_hide_summary_confirmation"),e.debug("User opted to show summary confirmation popup")),t.remove(),this.generateChannelSummary(n)}));a.querySelector("#cancel-generate-btn").addEventListener("click",(()=>{s.checked?(localStorage.setItem("slackpolish_hide_summary_confirmation","true"),e.debug("User opted to hide summary confirmation popup")):(localStorage.removeItem("slackpolish_hide_summary_confirmation"),e.debug("User opted to show summary confirmation popup")),t.remove(),n.remove()})),t.addEventListener("click",(e=>{e.target===t&&t.remove()}))},generateChannelSummary:async function(n){const t=n._threadContext||{isInThread:!1},a=n.querySelector("#summary-textbox"),s=n.querySelector("#generate-summary-btn"),r=n.querySelector("#time-range-select").value,o=n.querySelector("#summary-level-select").value;e.log("Generate Channel Summary clicked"),e.debug("üîç THREAD DETECTION CHECK (CAPTURED EARLY)",t),e.debug("Channel summary generation started",{timeRange:r,summaryLevel:o}),s.disabled=!0,s.textContent="‚è≥ Fetching Messages...",a.value="Fetching channel messages...\n\nPlease wait while we gather the relevant messages from this channel.";try{if(!window.SlackPolishChannelMessages)throw new Error("SlackPolish Channel Messages module not available. Please refresh the page.");e.debug("Using SlackPolishChannelMessages module for message fetching");let n=null;if(t.isInThread){e.debug("üßµ THREAD DETECTED - Extracting thread messages from DOM");try{const n=this.getThreadMessagesFromDOM();if(e.debug("üßµ Thread messages extracted from DOM",{messageCount:n.length}),n.length>0){const e=this.getCurrentChannelInfo(),t={messages:n,totalReturned:n.length,method:"DOM-Thread",fetchedAt:(new Date).toISOString(),channelId:e.id,channelName:`A thread in channel ${e.name}`};return void await this.processAndDisplaySummary(t,o,a,s)}e.debug("üßµ No thread messages found in DOM"),a.value="‚ùå Thread Summary Error\n\nNo thread messages found in DOM\n\nFalling back to channel summary..."}catch(n){e.debug("üßµ Thread message extraction failed",{error:n.message}),a.value=`‚ùå Thread Summary Error\n\nFailed to extract thread messages: ${n.message}\n\nFalling back to channel summary...`}}else e.debug("üìù MAIN CHANNEL DETECTED - Continuing with regular summary"),n=await this.getChannelSummaryMessages(r);if(e.debug("üîç Checking if we need to detect channel name",{hasChannelName:!!n.channelName,currentChannelName:n.channelName}),n.channelName)e.debug("‚úÖ Channel name already present in result",{channelName:n.channelName});else{e.debug("üîç No channel name in result, detecting...");const t=this.getCurrentChannelInfo();n.channelName=t.name,!n.channelId&&t.id&&(n.channelId=t.id),e.debug("‚úÖ Updated result with detected channel info",{channelName:n.channelName,channelId:n.channelId})}e.debug("Message fetching completed",{method:n.method,messageCount:n.messages.length,channelId:n.channelId,channelName:n.channelName}),s.textContent="ü§ñ Generating Summary...",await this.processAndDisplaySummary(n,o,a,s)}catch(n){e.debug("Error in generateChannelSummary",{error:n.message}),this.stopAISummaryAnimation(),n.message.includes("Invalid API key")||n.message.includes("API quota exceeded")||n.message.includes("API access forbidden")||n.message.includes("OpenAI API key not found")?a.value=`‚ùå API Key Issue: ${n.message}\n\nPlease update your OpenAI API key using the popup that appeared, or:\n1. Get your API key from https://platform.openai.com/api-keys\n2. Open SlackPolish settings (F12) and add your API key\n3. Try generating the summary again`:a.value=`‚ùå Error: ${n.message}\n\nPlease try again or check the debug window for more details.`,s.disabled=!1,s.textContent="üîç Generate Summary"}},calculateDateRange:function(e){const n=new Date;let t=null,a=n;switch(e){case"1":case"last24hours":default:t=new Date(n.getTime()-864e5);break;case"7":case"last7days":t=new Date(n.getTime()-6048e5);break;case"30":case"last30days":t=new Date(n.getTime()-2592e6);break;case"all":t=null,a=null}return{startDate:t,endDate:a}},isUserInThreadInput:function(){try{e.log("üîç CHANNEL SUMMARY: isUserInThreadInput() called");const n=document.activeElement;if(e.log("üîç CHANNEL SUMMARY: Checking active element"),!n)return e.log("‚ùå CHANNEL SUMMARY: No active element found"),!1;if(!n.isContentEditable)return e.log("‚ùå CHANNEL SUMMARY: Active element is not editable"),!1;e.log("üîç CHANNEL SUMMARY: Checking for thread container");const t=n.closest('.p-thread_view, .p-threads_view, [data-qa*="thread"]'),a=!!t;return e.log(`üéØ CHANNEL SUMMARY: Final result - isInThread: ${a}`),e.debug("CHANNEL SUMMARY: Thread detection details",{hasActiveElement:!0,isContentEditable:!0,hasThreadContainer:!!t,isInThread:a}),a}catch(n){return e.log("‚ùå CHANNEL SUMMARY: Error in isUserInThreadInput"),e.debug("CHANNEL SUMMARY: isUserInThreadInput error",{error:n.message}),!1}},async getChannelSummaryMessages(n){const t=this.calculateDateRange(n);e.debug("Fetching channel summary messages",{timeRange:n,dateRange:t});let a=null,s=this.getMessageCountForTimeRange(n);try{a="all"===n?await window.SlackPolishChannelMessages.getAllChannelMessages(!0):t.startDate&&t.endDate?await window.SlackPolishChannelMessages.getMessagesInRange(t.startDate,t.endDate,!0):await window.SlackPolishChannelMessages.getRecentMessages(s)}catch(r){e.debug("API-based channel message fetching failed, trying DOM fallback",{error:r.message});try{if(a=await window.SlackPolishChannelMessages.getRecentMessagesFromDOM(s),"all"!==n&&t.startDate&&t.endDate){const e=new Date(t.startDate).getTime(),n=new Date(t.endDate).getTime();a.messages=a.messages.filter((t=>{if(!t.timestamp)return!1;const a=new Date(t.timestamp).getTime();return a>=e&&a<=n})),a.totalReturned=a.messages.length,a.method=a.method+"-Filtered"}}catch(n){throw e.debug("DOM fallback also failed",{error:n.message}),new Error("Failed to fetch channel messages using both API and DOM methods. Please try again.")}}return a},async getThreadSummaryMessages(n){e.debug("Fetching thread summary messages",{timeRange:n});const t=this.getCurrentThreadTs();if(!t)throw new Error("Could not determine thread timestamp for summary");const a=window.SlackPolishChannelMessages.getCurrentChannelId();if(!a)throw new Error("Could not determine channel ID for thread summary");e.debug("Thread summary parameters",{threadTs:t,channelId:a});try{const e=await window.SlackPolishChannelMessages.callSlackAPI("conversations.replies",{channel:a,ts:t,limit:1e3});if(e.ok&&e.messages){let s=e.messages.map((e=>window.SlackPolishChannelMessages.processSlackMessage(e)));if("all"!==n){const e=this.calculateDateRange(n);if(e.startDate&&e.endDate){const n=new Date(e.startDate).getTime(),t=new Date(e.endDate).getTime();s=s.filter((e=>{if(!e.timestamp)return!0;const a=new Date(e.timestamp).getTime();return a>=n&&a<=t}))}}return{channelId:a,channelName:window.SlackPolishChannelMessages.getCurrentChannelName(),threadTs:t,messages:s,totalReturned:s.length,method:"API-Thread-Summary",fetchedAt:(new Date).toISOString(),isThreadSummary:!0}}}catch(n){e.debug("Thread API call failed, trying DOM fallback",{error:n.message})}return this.getThreadSummaryFromDOM(n,t,a)},getCurrentThreadTs:function(){const n=window.location.href.match(/\/thread\/p(\d+)/);if(n&&n[1]){const t=n[1],a=t.substring(0,10)+"."+t.substring(10);return e.debug("Thread timestamp from URL for summary",{pTimestamp:t,timestamp:a}),a}const t=document.querySelector('.p-thread_view, .p-threads_view, [data-qa*="thread"]');if(t){const n=t.querySelector("[data-ts]");if(n){const t=n.getAttribute("data-ts");return e.debug("Thread timestamp from DOM for summary",{timestamp:t}),t}}return e.debug("Could not determine thread timestamp for summary"),null},async getThreadSummaryFromDOM(n,t,a){e.debug("Extracting thread summary from DOM");const s=document.querySelector('.p-thread_view, .p-threads_view, [data-qa*="thread"]');if(!s)throw new Error("Thread container not found in DOM for summary");const r=[],o=s.querySelectorAll('[data-qa="virtual_list_item"], .c-message_kit__message, [role="listitem"]');for(const n of o)try{const e=window.SlackPolishChannelMessages.extractMessageData(n);e&&e.text&&r.push({...e,isThreadReply:!0})}catch(n){e.debug("Error extracting thread message from DOM element for summary",{error:n.message})}let i=r;if("all"!==n){const e=this.calculateDateRange(n);if(e.startDate&&e.endDate){const n=new Date(e.startDate).getTime(),t=new Date(e.endDate).getTime();i=r.filter((e=>{if(!e.timestamp)return!0;const a=new Date(e.timestamp).getTime();return a>=n&&a<=t}))}}return{channelId:a,channelName:window.SlackPolishChannelMessages.getCurrentChannelName(),threadTs:t,messages:i,totalReturned:i.length,method:"DOM-Thread-Summary",fetchedAt:(new Date).toISOString(),isThreadSummary:!0}},getMessageCountForTimeRange:function(e){switch(e){case"1":case"last24hours":default:return 50;case"7":case"last7days":return 200;case"30":case"last30days":return 500;case"all":return 1e3}},getThreadMessagesFromDOM:function(){e.debug("üßµ Extracting thread messages from DOM");const n=['[data-qa="threads_view"] .c-message_kit__message',".p-threads_view .c-message_kit__message",'[data-qa="thread_view"] .c-message_kit__message',".p-thread_view .c-message_kit__message",'[data-qa*="thread"] .c-message_kit__message',".c-thread .c-message_kit__message"];let t=[];for(const a of n)if(t=document.querySelectorAll(a),t.length>0){e.debug("üßµ Found thread messages with selector",{selector:a,count:t.length});break}0===t.length&&(t=document.querySelectorAll(".c-message_kit__message"),e.debug("üßµ Using general message selector",{count:t.length}));const a=[];return t.forEach(((n,t)=>{try{const e=window.SlackPolishChannelMessages.extractMessageData(n);e&&e.text&&e.text.trim()&&a.push(e)}catch(n){e.debug("üßµ Error extracting thread message",{error:n.message,index:t})}})),e.debug("üßµ Thread messages extracted from DOM",{messageCount:a.length}),a},getMaxTokensForSummaryLevel:function(e){const n=window.SLACKPOLISH_CONFIG;switch(e){case"executive":return n?.EXECUTIVE_SUMMARY_MAX_TOKENS||2e3;case"comprehensive":return n?.COMPREHENSIVE_SUMMARY_MAX_TOKENS||4e3;default:return n?.DEFAULT_SUMMARY_MAX_TOKENS||3e3}},getCurrentChannelInfo:function(){try{e.debug("üîç Starting channel detection...");let n="Unknown Channel";const t=['[data-qa="channel_header_name"]','[data-qa="channel-name"]','[data-qa="channel_name"]','[data-qa="channel_header"] [data-qa="channel_name"]','[data-qa="channel_header"] h1','[data-qa="dm_header"] h1','[data-qa="channel_header"] span','[data-qa="channel_header"] button span',".p-view_header__channel_title",".p-channel_header__name",".p-channel_header__title",'[data-qa="channel_header"] .p-channel_header__title',".p-view_header__title",".p-view_header__breadcrumbs",'h1[data-qa*="channel"]','span[data-qa*="channel"]','button[data-qa*="channel"] span','[class*="channel_header"] h1','[class*="channel_header"] span','[class*="view_header"] h1','[class*="view_header"] span',".p-channel_sidebar__name--selected",".c-channel_entity__name",".p-classic_nav__model__title__name","header h1",'[role="banner"] h1',".c-view_header h1","main h1","section h1"];e.debug("üîç Starting channel name detection...",{totalSelectors:t.length});for(let a=0;a<t.length;a++){const s=t[a];try{const r=document.querySelector(s),o=!!r&&!!r.textContent?.trim(),i=r?r.textContent?.trim().substring(0,50):null;if(e.debug(`üîç Selector ${a+1}/${t.length}: ${s}`,{found:!!r,hasText:o,text:i}),r&&r.textContent?.trim()){n=r.textContent.trim(),e.debug("‚úÖ Found channel name using selector",{selector:s,channelName:n});break}}catch(n){e.debug(`‚ùå Error with selector ${s}`,{error:n.message})}}if("Unknown Channel"===n){e.debug("üîç No DOM selector worked, trying URL extraction...");const t=window.location.href;e.debug("üîç Current URL",{url:t});const a=t.match(/\/client\/[^\/]+\/([^\/\?]+)/);if(a&&a[1]){const t=a[1];e.debug("üîç Extracted channel ID from URL",{channelId:t}),n=t.startsWith("C")?`#${t}`:t.startsWith("D")?"Direct Message":t,e.debug("‚úÖ Using URL-based channel name",{channelName:n,channelId:t})}else e.debug("‚ùå Could not extract channel ID from URL")}const a={name:n,id:this.extractChannelId(),type:n.startsWith("#")?"channel":"dm"};return e.debug("üéØ Final channel detection result",a),a}catch(n){return e.debug("‚ùå Error getting channel info",{error:n.message}),{name:"Current Channel",id:null,type:"unknown"}}},extractChannelId:function(){try{const e=window.location.href.match(/\/client\/[^\/]+\/([^\/\?]+)/);return e?e[1]:null}catch(n){return e.debug("Error extracting channel ID",{error:n.message}),null}},processAndDisplaySummary:async function(n,t,a,s){try{const e=this.formatMessagesForAI(n.messages);if(this.startAISummaryAnimation(a,n,t),n.messages.length>0){const s=await this.generateAISummary(e,t,n);this.stopAISummaryAnimation(),a.value=this.formatFinalSummary(n,t,s)}else this.stopAISummaryAnimation(),a.value=this.formatNoMessagesFound(n);s.disabled=!1,s.textContent="üîç Generate Summary"}catch(n){throw e.debug("Error in processAndDisplaySummary",{error:n.message}),n}},startAISummaryAnimation:function(e,n,t){const a=["‚†ã","‚†ô","‚†π","‚†∏","‚†º","‚†¥","‚†¶","‚†ß","‚†á","‚†è"];let s=0;const r=n.channelName||"Unknown Channel",o=n.messages.length,i=(new Date).toLocaleString(),l=n.isThreadSummary||!1,d=l?"üßµ THREAD SUMMARY REPORT":"üìä CHANNEL SUMMARY REPORT",c=l?`üßµ  THREAD IN: ${r}`:`üè∑Ô∏è  CHANNEL: ${r}`;this.aiSummaryInterval=setInterval((()=>{const n=a[s];e.value=`‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó\n‚ïë                    ${d}                 ‚ïë\n‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù\n\n${c}\nüìä  MESSAGES FOUND: ${o}\nüìÖ  GENERATED: ${i}\n\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ                ${n} GENERATING AI SUMMARY...                  ‚îÇ\n‚îÇ          Please wait while we analyze the messages         ‚îÇ\n‚îÇ                   Summary Level: ${t.toUpperCase()}                    ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò`,s=(s+1)%a.length}),100)},stopAISummaryAnimation:function(){this.aiSummaryInterval&&(clearInterval(this.aiSummaryInterval),this.aiSummaryInterval=null)},formatLoadingDisplay:function(e,n){return`‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó\n‚ïë                    üìä CHANNEL SUMMARY REPORT                 ‚ïë\n‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù\n\nüè∑Ô∏è  CHANNEL: ${e.channelName||"Unknown Channel"}\nüìä  MESSAGES FOUND: ${e.messages.length}\nüìÖ  GENERATED: ${(new Date).toLocaleString()}\n\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ                ü§ñ GENERATING AI SUMMARY...                  ‚îÇ\n‚îÇ          Please wait while we analyze the messages         ‚îÇ\n‚îÇ                   Summary Level: ${n.toUpperCase()}                    ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò`},formatFinalSummary:function(e,n,t){const a=e.channelName||"Unknown Channel",s=e.messages.length,r=e.isThreadSummary||!1,o=new Set;e.messages.forEach((e=>{e.user&&"Unknown"!==e.user&&o.add(e.user)}));let i="Unknown";if(e.messages.length>0){const n=e.messages.map((e=>e.timestamp)).filter((e=>e)).sort();if(n.length>0){const e=new Date(n[0]).toLocaleDateString(),t=new Date(n[n.length-1]).toLocaleDateString();i=e===t?e:`${e} - ${t}`}}const l=r?"SlackPolish Thread Summary":"SlackPolish Channel Summary";return`‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó\n‚ïë                    ${r?"üßµ THREAD SUMMARY REPORT":"üìä CHANNEL SUMMARY REPORT"}                 ‚ïë\n‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù\n\n${r?`üßµ  THREAD IN: ${a}`:`üè∑Ô∏è  CHANNEL: ${a}`}\nüìä  MESSAGES ANALYZED: ${s}\nüë•  CONTRIBUTORS: ${o.size}\nüìÖ  DATE RANGE: ${i}\nüéØ  SUMMARY LEVEL: ${n.toUpperCase()}\n‚è∞  GENERATED: ${(new Date).toLocaleString()}\n\n‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó\n‚ïë                        ü§ñ AI SUMMARY                         ‚ïë\n‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù\n\n${t}\n\n‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó\n‚ïë                      üìã SUMMARY COMPLETE                     ‚ïë\n‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù\n\nGenerated by ${l} ‚Ä¢ ${(new Date).toLocaleString()}`},formatNoMessagesFound:function(e){return`‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó\n‚ïë                    üìä CHANNEL SUMMARY REPORT                 ‚ïë\n‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù\n\nüè∑Ô∏è  CHANNEL: ${e.channelName||"Unknown Channel"}\nüìä  MESSAGES FOUND: 0\n‚è∞  GENERATED: ${(new Date).toLocaleString()}\n\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ                     ‚ùå NO MESSAGES FOUND                    ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n\nNo messages were found in the selected time range for this channel.\n\nüí° SUGGESTIONS:\n   ‚Ä¢ Try selecting a different time range (e.g., "Last 7 days" or "Entire channel")\n   ‚Ä¢ Scroll through the channel to load more message history\n   ‚Ä¢ Check if you have access to this channel's message history\n   ‚Ä¢ Verify that the channel has messages in the selected time period\n\n‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó\n‚ïë                        üìã NO SUMMARY                         ‚ïë\n‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù\n\nGenerated by SlackPolish Channel Summary ‚Ä¢ ${(new Date).toLocaleString()}`},formatMessagesForAI:function(e){return e&&0!==e.length?e.map((e=>`${e.timestamp?new Date(e.timestamp).toLocaleString():""} - ${e.user||"Unknown"}: ${e.text||""}`)).join("\n"):"No messages to summarize."},generateAISummary:async function(n,t,a){try{const s=localStorage.getItem("slackpolish_openai_api_key");if(!s)throw this.showApiKeyUpdatePopup("OpenAI API key not configured. Please enter your API key to use Channel Summary."),new Error("OpenAI API key not found. Please configure your API key in SlackPolish settings.");const r=this.createSummaryPrompt(n,t,a);e.debug("Generating AI summary",{messageLength:n.length,summaryLevel:t,channelName:a.channelName,hasApiKey:!!s});const o=await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify({model:window.SLACKPOLISH_CONFIG?.OPENAI_MODEL||"gpt-4-turbo",messages:[{role:"user",content:r}],max_tokens:this.getMaxTokensForSummaryLevel(t),temperature:window.SLACKPOLISH_CONFIG?.CHANNEL_SUMMARY_TEMPERATURE||.3})});if(!o.ok)throw 401===o.status?(this.showApiKeyUpdatePopup("Invalid or missing API key. Please update your OpenAI API key."),new Error("Invalid API key")):429===o.status?(this.showApiKeyUpdatePopup("OpenAI API quota exceeded or billing issue. Please check your OpenAI account or update your API key."),new Error("API quota exceeded")):403===o.status?(this.showApiKeyUpdatePopup("OpenAI API access forbidden. Please check your API key permissions."),new Error("API access forbidden")):new Error(`OpenAI API error: ${o.status} ${o.statusText}`);const i=await o.json();if(i.choices&&i.choices[0]&&i.choices[0].message)return i.choices[0].message.content;throw new Error("Invalid response format from OpenAI API")}catch(n){if(e.debug("Error generating AI summary",{error:n.message}),!n.message.includes("Invalid API key")&&!n.message.includes("API quota exceeded")&&!n.message.includes("API access forbidden"))return`‚ùå Failed to generate AI summary: ${n.message}\n\nRaw messages are shown above for your reference.`;throw n}},createSummaryPrompt:function(e,n,t){const a=t.channelName||"this channel";let s="",r="";return"executive"===n?(s="Create a concise executive summary focusing on key decisions, action items, and important announcements. Keep it brief and actionable.",r="Format your response as follows:\n\nüéØ KEY HIGHLIGHTS\n‚Ä¢ [Most important points in bullet format]\n\nüìã ACTION ITEMS\n‚Ä¢ [Specific tasks or decisions mentioned]\n\nüìä METRICS/NUMBERS\n‚Ä¢ [Any important numbers, dates, or metrics mentioned]\n\n‚ö†Ô∏è IMPORTANT NOTES\n‚Ä¢ [Critical information that needs attention]"):"comprehensive"===n?(s="Create a detailed comprehensive summary including main topics discussed, key participants, decisions made, action items, and important context. Organize by themes or chronology as appropriate.",r="Format your response as follows:\n\nüìù OVERVIEW\n[Brief overview of the main discussion]\n\nüó£Ô∏è KEY PARTICIPANTS\n‚Ä¢ [List main contributors to the discussion]\n\nüìã MAIN TOPICS DISCUSSED\n‚Ä¢ [Topic 1]: [Description]\n‚Ä¢ [Topic 2]: [Description]\n‚Ä¢ [Topic 3]: [Description]\n\n‚úÖ DECISIONS MADE\n‚Ä¢ [List any decisions or conclusions reached]\n\nüìã ACTION ITEMS\n‚Ä¢ [Specific tasks or follow-ups mentioned]\n‚Ä¢ [Include assignees if mentioned]\n\nüìÖ IMPORTANT DATES\n‚Ä¢ [Any deadlines, meetings, or time-sensitive items]\n\nüí° KEY INSIGHTS\n‚Ä¢ [Important observations or insights from the discussion]\n\n‚ö†Ô∏è FOLLOW-UP NEEDED\n‚Ä¢ [Items that require further attention or clarification]"):(s="Create a balanced summary covering the main topics and key points discussed.",r="Format your response with clear sections and bullet points for easy reading."),`Please analyze the following ${t.messages.length} messages from ${a} and create a well-structured summary.\n\nINSTRUCTIONS:\n${s}\n\n${r}\n\nMESSAGES TO ANALYZE:\n${e}\n\nPlease provide your summary now:`},showApiKeyUpdatePopup:function(n){const t=document.getElementById("slackpolish-api-popup");t&&t.remove();const a=document.createElement("div");a.id="slackpolish-api-popup",a.style.cssText="\n                position: fixed;\n                top: 50%;\n                left: 50%;\n                transform: translate(-50%, -50%);\n                background: white;\n                border: 2px solid #007a5a;\n                border-radius: 8px;\n                padding: 20px;\n                box-shadow: 0 4px 12px rgba(0,0,0,0.3);\n                z-index: 10000;\n                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n                max-width: 400px;\n                width: 90%;\n            ",a.innerHTML=`\n                <div style="margin-bottom: 15px;">\n                    <h3 style="margin: 0 0 10px 0; color: #007a5a;">üîë SlackPolish API Key</h3>\n                    <p style="margin: 0; color: #333; font-size: 14px;">${n}</p>\n                </div>\n                <div style="margin-bottom: 15px;">\n                    <input type="password" id="api-key-input" placeholder="Enter your OpenAI API key (sk-...)"\n                           style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px; font-size: 14px; box-sizing: border-box;">\n                </div>\n                <div style="display: flex; gap: 10px; justify-content: flex-end;">\n                    <button id="cancel-api-key" style="padding: 8px 16px; border: 1px solid #ccc; background: white; border-radius: 4px; cursor: pointer;">Cancel</button>\n                    <button id="save-api-key" style="padding: 8px 16px; border: none; background: #007a5a; color: white; border-radius: 4px; cursor: pointer;">Save</button>\n                </div>\n                <div style="margin-top: 10px; font-size: 12px; color: #666;">\n                    Get your API key from <a href="https://platform.openai.com/api-keys" target="_blank" style="color: #007a5a;">OpenAI Platform</a>\n                </div>\n            `,document.body.appendChild(a);const s=a.querySelector("#api-key-input");s.focus();const r=a.querySelector("#save-api-key"),o=a.querySelector("#cancel-api-key"),i=()=>{const n=s.value.trim();n?(this.updateApiKey(n),a.remove(),e.showNotification("API key saved successfully!","success")):(s.style.borderColor="#e01e5a",s.focus())};r.addEventListener("click",i),o.addEventListener("click",(()=>{a.remove()})),s.addEventListener("keydown",(e=>{"Enter"===e.key&&(e.preventDefault(),i())})),document.addEventListener("keydown",(function e(n){"Escape"===n.key&&(a.remove(),document.removeEventListener("keydown",e))}))},updateApiKey:function(n){try{localStorage.setItem("slackpolish_openai_api_key",n),e.log("üîë API key updated and saved for future use")}catch(n){e.log(`‚ùå Error updating API key: ${n.message}`)}},showNotification:function(e,n="info"){const t=document.createElement("div");t.style.cssText=`\n                position: fixed;\n                top: 20px;\n                right: 20px;\n                background: ${"error"===n?"#d93025":"#1264a3"};\n                color: white;\n                padding: 12px 20px;\n                border-radius: 6px;\n                z-index: 10002;\n                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n                font-size: 14px;\n                box-shadow: 0 4px 20px rgba(0,0,0,0.3);\n            `,t.textContent=e,document.body.appendChild(t),setTimeout((()=>{t.parentNode&&t.parentNode.removeChild(t)}),3e3)}};function t(){e.log("Channel Summary module initialized"),e.debug("Channel Summary module initialization",{hasGlobalDebug:!!window.SlackPolishDebug,currentSettings:n.loadSettings()}),document.addEventListener("keydown",(function(e){"F10"===e.key&&(e.preventDefault(),n.showChannelSummary())}))}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",t):t()}();